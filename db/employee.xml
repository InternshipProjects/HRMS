<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="employee" author="dhanalakshmi">
        <createTable tableName="employee">
            <column name="id" type="int">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="emp_id" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="address" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="phone_no" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <addUniqueConstraint constraintName="unique_employee_emp_id" columnNames="emp_id" tableName="employee"/>

        <addUniqueConstraint constraintName="unique_employee_email" columnNames="email" tableName="employee"/>

        <addAutoIncrement columnDataType="int" columnName="id" defaultOnNull="false" generationType="ALWAYS"
            incrementBy="1" startWith="1" tableName="employee"/>
    </changeSet>  

    <changeSet id="skills" author="dhanalakshmi">
        <createTable tableName="skills">
            <column name="id" type="int">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addUniqueConstraint constraintName="unique_skill_name" columnNames="name" tableName="skills"/>

        <addAutoIncrement columnDataType="int" columnName="id" defaultOnNull="false" generationType="ALWAYS"
            incrementBy="1" startWith="1" tableName="skills"/>
    </changeSet>  

    <changeSet id="employee_skills" author="dhanalakshmi">
        <createTable tableName="employee_skills">
            <column name="id" type="int">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="employee_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="skill_id" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addAutoIncrement columnDataType="int" columnName="id" defaultOnNull="false" generationType="ALWAYS"
            incrementBy="1" startWith="1" tableName="employee_skills"/>

        <addForeignKeyConstraint baseColumnNames="employee_id" baseTableName="employee_skills"
            constraintName="employee_id_fk" referencedColumnNames="id" referencedTableName="employee"/>

        <addForeignKeyConstraint baseColumnNames="skill_id" baseTableName="employee_skills"
            constraintName="skills_id_fk" referencedColumnNames="id" referencedTableName="skills"/>
        
        <addUniqueConstraint columnNames="employee_id, skill_id" constraintName="unique_employee_skill" tableName="employee_skills" />
    </changeSet>

    <changeSet id="company_employees" author="dhanalakshmi">
        <createTable tableName="company_employees">
            <column name="id" type="int">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="employee_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="company_id" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addAutoIncrement columnDataType="int" columnName="id" defaultOnNull="false" generationType="ALWAYS"
            incrementBy="1" startWith="1" tableName="company_employees"/>

        <addForeignKeyConstraint baseColumnNames="employee_id" baseTableName="company_employees"
            constraintName="employee_id_fk" referencedColumnNames="id" referencedTableName="employee"/>
        
        <addForeignKeyConstraint baseColumnNames="company_id" baseTableName="company_employees"
            constraintName="company_id_fk" referencedColumnNames="id" referencedTableName="company"/>
    </changeSet>
</databaseChangeLog>